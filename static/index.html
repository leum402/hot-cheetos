<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ê¸‰ë“±ì£¼ TOP 10 | ì‹¤ì‹œê°„ ì£¼ì‹ ëŒ€ì‹œë³´ë“œ</title>
  <style>
    /* ===== ê³µí†µ/í…Œë§ˆ ===== */
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --bg-primary:#0a0e1a;--bg-secondary:#141922;--bg-card:#1c2333;
      --text-primary:#fff;--text-secondary:#8892a6;
      --accent-red:#ff4757;--accent-green:#00d68f;--accent-blue:#5f72ff;
      --gradient-primary:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      --gradient-red:linear-gradient(135deg,#ff4757 0%,#e91e63 100%);
    }
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;overflow-x:hidden}
    .container{max-width:480px;margin:0 auto;position:relative}
    /* ===== ìƒíƒœ ===== */
    .connection-status{position:fixed;top:10px;right:10px;z-index:1000;background:rgba(0,0,0,.8);padding:8px 15px;border-radius:20px;font-size:12px;display:flex;gap:8px;align-items:center;border:1px solid rgba(255,255,255,.1);backdrop-filter:blur(10px)}
    .status-dot{width:8px;height:8px;border-radius:50%;animation:pulse 2s infinite}
    .status-dot.connected{background:#00ff88}.status-dot.disconnected{background:#ff4757}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
    /* ===== í—¤ë” ===== */
    .header{background:var(--gradient-primary);padding:25px 20px;position:sticky;top:0;z-index:100;box-shadow:0 10px 30px rgba(102,126,234,.2)}
    .header-content{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
    .header h1{font-size:24px;font-weight:700;display:flex;gap:10px;align-items:center}
    .rocket-icon{font-size:28px}
    .live-indicator{display:flex;gap:6px;align-items:center;background:rgba(255,255,255,.2);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600}
    .live-dot{width:8px;height:8px;background:#00ff88;border-radius:50%;animation:pulse 1.5s infinite}
    .update-time{font-size:13px;opacity:.9;display:flex;gap:5px;align-items:center}
    /* ===== í†µê³„ ===== */
    .stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:15px;background:var(--bg-secondary)}
    .stat-card{background:var(--bg-card);padding:15px;border-radius:12px;text-align:center;border:1px solid rgba(255,255,255,.05)}
    .stat-value{font-size:20px;font-weight:700;margin-bottom:5px}
    .stat-label{font-size:11px;color:var(--text-secondary);letter-spacing:.5px;text-transform:uppercase}
    /* ===== ëª¨ë“œ ===== */
    .mode-switch{display:flex;gap:10px;padding:10px 15px;background:var(--bg-secondary);border-bottom:1px solid rgba(255,255,255,.05)}
    .mode-btn{flex:1;padding:10px;border:none;background:var(--bg-card);color:var(--text-secondary);border-radius:8px;font-size:14px;font-weight:600;cursor:pointer}
    .mode-btn.active{background:var(--gradient-primary);color:#fff}
    /* ===== ë¦¬ìŠ¤íŠ¸ ===== */
    .stocks-container{padding:15px 15px 80px;min-height:400px}
    .stock-card{background:var(--bg-card);border-radius:16px;margin-bottom:12px;overflow:hidden;border:1px solid rgba(255,255,255,.05);animation:slideIn .5s ease-out}
    @keyframes slideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
    .stock-header{padding:15px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.05)}
    .stock-info{display:flex;gap:12px;align-items:center;flex:1}
    .rank-badge{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:18px;background:var(--gradient-primary)}
    .rank-badge.top1{background:linear-gradient(135deg,#ffd700 0%,#ffb347 100%)}
    .rank-badge.top2{background:linear-gradient(135deg,#c0c0c0 0%,#b8b8b8 100%)}
    .rank-badge.top3{background:linear-gradient(135deg,#cd7f32 0%,#b87333 100%)}
    .stock-name h3{font-size:16px;font-weight:600;margin-bottom:3px}
    .stock-price{font-size:13px;color:var(--text-secondary)}
    .rate-badge{padding:8px 14px;border-radius:10px;font-weight:700;font-size:15px;min-width:70px;text-align:center;background:var(--gradient-red)}
    .stock-news{padding:15px;background:rgba(0,0,0,.2)}
    .news-title{display:flex;gap:6px;align-items:center;font-size:13px;font-weight:600;margin-bottom:6px}
    .news-good{color:var(--accent-green)} .news-bad{color:var(--accent-red)}
    .news-content{font-size:12px;line-height:1.5;color:var(--text-secondary);padding-left:20px}
    .news-content a{color:#5f72ff;text-decoration:underline} .news-content a:active{opacity:.85}
    /* ë¡œë”©/ê¸°íƒ€ */
    .loading-container{text-align:center;padding:40px}
    .loading-spinner{width:50px;height:50px;border:3px solid var(--bg-card);border-top:3px solid var(--accent-blue);border-radius:50%;animation:spin 1s linear infinite;margin:20px auto}
    @keyframes spin{to{transform:rotate(360deg)}}
    .empty-state{text-align:center;padding:60px 20px}.empty-icon{font-size:64px;margin-bottom:20px;opacity:.5}
    .empty-title{font-size:18px;margin-bottom:10px;color:var(--text-secondary)}
    .empty-desc{font-size:14px;color:var(--text-secondary);opacity:.7}
    .fab-refresh{position:fixed;bottom:20px;right:20px;width:56px;height:56px;border-radius:50%;background:var(--gradient-primary);color:#fff;border:none;box-shadow:0 8px 25px rgba(102,126,234,.4);font-size:24px;z-index:1000}
    .toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%) translateY(100px);background:rgba(0,0,0,.9);color:#fff;padding:12px 20px;border-radius:25px;font-size:14px;opacity:0;transition:.3s;z-index:1001}
    .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
    @media (min-width:768px){.container{max-width:768px}.stocks-container{display:grid;grid-template-columns:repeat(2,1fr);gap:15px}}
  </style>
</head>
<body>
  <div class="container">
    <!-- ì—°ê²° ìƒíƒœ -->
    <div class="connection-status">
      <div class="status-dot disconnected" id="statusDot"></div>
      <span id="statusText">ì—°ê²° ëŒ€ê¸°ì¤‘</span>
    </div>

    <!-- í—¤ë” -->
    <div class="header">
      <div class="header-content">
        <h1><span class="rocket-icon">ğŸš€</span>ê¸‰ë“±ì£¼ TOP 10</h1>
        <div class="live-indicator"><div class="live-dot"></div>LIVE</div>
      </div>
      <div class="update-time"><span>â°</span><span id="updateTime">ì—…ë°ì´íŠ¸ ì¤‘...</span></div>
    </div>

    <!-- í†µê³„ -->
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-value" style="color:var(--accent-red)"><span id="avgRate">+0%</span></div><div class="stat-label">í‰ê·  ìƒìŠ¹ë¥ </div></div>
      <div class="stat-card"><div class="stat-value" style="color:var(--accent-green)"><span id="goodNewsCount">0</span></div><div class="stat-label">í˜¸ì¬ ì¢…ëª©</div></div>
      <div class="stat-card"><div class="stat-value" style="color:var(--accent-blue)"><span id="totalVolume">0</span></div><div class="stat-label">ê±°ë˜ëŸ‰ ì§€ìˆ˜</div></div>
    </div>

    <!-- ëª¨ë“œ -->
    <div class="mode-switch">
      <button class="mode-btn active" id="liveMode" onclick="switchMode('live')">ğŸ”´ ì‹¤ì‹œê°„ ëª¨ë“œ</button>
      <button class="mode-btn" id="testMode" onclick="switchMode('test')">ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ</button>
    </div>

    <!-- ë¦¬ìŠ¤íŠ¸ -->
    <div class="stocks-container" id="stocksList">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <p style="color:var(--text-secondary);margin-top:20px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>

    <!-- FAB & í† ìŠ¤íŠ¸ -->
    <button class="fab-refresh" id="refreshBtn" onclick="manualRefresh()">â†»</button>
    <div class="toast" id="toast"></div>
  </div>

  <script>
    const CONFIG = {
    API_URL: window.location.origin + '/api/stocks',
    API_STATUS_URL: window.location.origin + '/api/status',
    REFRESH_INTERVAL: 15000,
    MODE: 'test'
};

    let isLoading=false, autoRefreshInterval=null, connectionCheckInterval=null;

    // í…ŒìŠ¤íŠ¸ìš© ëª¨ì˜ ë°ì´í„°(ë§í¬ í¬í•¨ ì˜ˆì‹œ)
    const mockData = [
      {rank:1,name:"ì‚¼ì„±ì „ì",price:"87,500",rate:"+29.95%",summary:"ğŸŸ¢ í˜¸ì¬: AI ë°˜ë„ì²´ ëŒ€ê·œëª¨ ìˆ˜ì£¼ ê¸°ëŒ€\nğŸ”´ ì•…ì¬: ê¸€ë¡œë²Œ ê·œì œ ë¦¬ìŠ¤í¬",bullish_url:"https://example.com/bullish-1",bearish_url:"https://example.com/bearish-1"},
      {rank:2,name:"SKí•˜ì´ë‹‰ìŠ¤",price:"142,300",rate:"+28.32%",summary:"ğŸŸ¢ í˜¸ì¬: HBM4 ì–‘ì‚° ëŒì… ë°œí‘œ\nğŸ”´ ì•…ì¬: ë©”ëª¨ë¦¬ ê°€ê²© ì¡°ì • ì••ë ¥",bullish_url:"https://example.com/bullish-2",bearish_url:"https://example.com/bearish-2"},
      {rank:3,name:"ì¹´ì¹´ì˜¤",price:"58,900",rate:"+25.18%",summary:"ğŸŸ¢ í˜¸ì¬: ì‹ ê·œ AI ì„œë¹„ìŠ¤ ê³µê°œ\nğŸ”´ ì•…ì¬: í”Œë«í¼ ê·œì œ ë¦¬ìŠ¤í¬",bullish_url:"https://example.com/bullish-3",bearish_url:"https://example.com/bearish-3"},
      {rank:4,name:"ë„¤ì´ë²„",price:"185,200",rate:"+22.45%",summary:"ğŸŸ¢ í˜¸ì¬: ì¼ë³¸ ê³„ì—´ ì‹¤ì  í˜¸ì¡°\nğŸ”´ ì•…ì¬: ê´‘ê³  ì„±ì¥ ë‘”í™”",bullish_url:"https://example.com/bullish-4",bearish_url:"https://example.com/bearish-4"},
      {rank:5,name:"í˜„ëŒ€ì°¨",price:"245,000",rate:"+19.87%",summary:"ğŸŸ¢ í˜¸ì¬: EV íŒë§¤ 1ìœ„ ê¸°ëŒ€\nğŸ”´ ì•…ì¬: ì›ìì¬ ë¹„ìš© ë¶€ë‹´",bullish_url:"https://example.com/bullish-5",bearish_url:"https://example.com/bearish-5"},
      {rank:6,name:"LGí™”í•™",price:"485,000",rate:"+18.65%",summary:"ğŸŸ¢ í˜¸ì¬: ë¶ë¯¸ ìˆ˜ì£¼ í™•ëŒ€\nğŸ”´ ì•…ì¬: ê°€ê²© ê²½ìŸ ì‹¬í™”",bullish_url:"https://example.com/bullish-6",bearish_url:"https://example.com/bearish-6"},
      {rank:7,name:"í¬ìŠ¤ì½”í™€ë”©ìŠ¤",price:"392,500",rate:"+17.23%",summary:"ğŸŸ¢ í˜¸ì¬: ë¦¬íŠ¬ì‚¬ì—… ê°€ì†\nğŸ”´ ì•…ì¬: ì² ê°• ìˆ˜ìš” ë‘”í™”",bullish_url:"https://example.com/bullish-7",bearish_url:"https://example.com/bearish-7"},
      {rank:8,name:"ì‚¼ì„±SDI",price:"425,000",rate:"+16.54%",summary:"ğŸŸ¢ í˜¸ì¬: ì „ê³ ì²´ ë¡œë“œë§µ í™•ì •\nğŸ”´ ì•…ì¬: ì„¤ë¹„íˆ¬ì ë¶€ë‹´",bullish_url:"https://example.com/bullish-8",bearish_url:"https://example.com/bearish-8"},
      {rank:9,name:"ì…€íŠ¸ë¦¬ì˜¨",price:"178,900",rate:"+15.82%",summary:"ğŸŸ¢ í˜¸ì¬: ìœ ëŸ½ ìŠ¹ì¸ ì†Œì‹\nğŸ”´ ì•…ì¬: ê²½ìŸ ì‹¬í™”",bullish_url:"https://example.com/bullish-9",bearish_url:"https://example.com/bearish-9"},
      {rank:10,name:"ê¸°ì•„",price:"115,200",rate:"+14.95%",summary:"ğŸŸ¢ í˜¸ì¬: EV9 í¥í–‰ ì¡°ì§\nğŸ”´ ì•…ì¬: ë¶€í’ˆ ìˆ˜ê¸‰ ë¶ˆì•ˆ",bullish_url:"https://example.com/bullish-10",bearish_url:"https://example.com/bearish-10"}
    ];

    function switchMode(mode){
      CONFIG.MODE = mode;
      document.getElementById('liveMode').classList.toggle('active', mode==='live');
      document.getElementById('testMode').classList.toggle('active', mode==='test');
      fetchStockData();
      showToast(mode==='test'?'ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì „í™˜':'ğŸ”´ ì‹¤ì‹œê°„ ëª¨ë“œë¡œ ì „í™˜');
    }

    async function checkConnection(){
      const dot=document.getElementById('statusDot'), text=document.getElementById('statusText');
      try{
        const r=await fetch(CONFIG.API_STATUS_URL,{method:'GET',mode:'cors',cache:'no-cache'});
        if(r.ok){ dot.className='status-dot connected'; text.textContent='API ì—°ê²°ë¨'; return true; }
        throw new Error('API ì‘ë‹µ ì˜¤ë¥˜');
      }catch{
        dot.className='status-dot disconnected'; text.textContent='API ì—°ê²° ì•ˆë¨'; return false;
      }
    }

    async function fetchStockData(){
      if(isLoading) return; isLoading=true;
      const refreshBtn=document.getElementById('refreshBtn'); refreshBtn.classList.add('rotating');
      try{
        let data=[];
        if(CONFIG.MODE==='test'){
          data = mockData.map(s=>({...s}));
          data = data.map(s=>({...s, rate:`+${(parseFloat(s.rate)+Math.random()*2-1).toFixed(2)}%`}));
        }else{
          const ok=await checkConnection();
          if(!ok) throw new Error('API ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
          const r=await fetch(CONFIG.API_URL,{method:'GET',mode:'cors',headers:{'Accept':'application/json'}});
          if(!r.ok) throw new Error(`HTTP ${r.status}`);
          const payload=await r.json();
          data = Array.isArray(payload.stocks)? payload.stocks : [];
        }
        if(data.length){ renderStocks(data); updateStats(data); updateTime(); showToast(CONFIG.MODE==='test'?'ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¡œë“œ':'âœ… ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸'); }
        else { renderEmptyState(); showToast('ğŸ“Š ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤'); }
      }catch(e){
        console.error(e);
        if(CONFIG.MODE==='live'){ showToast('âš ï¸ API ì‹¤íŒ¨ â†’ í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì „í™˜'); setTimeout(()=>switchMode('test'),1200); }
        else{ renderErrorState(e.message); showToast('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨'); }
      }finally{
        isLoading=false; setTimeout(()=>refreshBtn.classList.remove('rotating'),600);
      }
    }

    function renderStocks(stocks){
      const c=document.getElementById('stocksList'); c.innerHTML='';
      stocks.forEach((s,i)=>{ const card=createStockCard(s); card.style.animationDelay=`${i*0.05}s`; c.appendChild(card); });
    }

    function createStockCard(stock){
      const card=document.createElement('div'); card.className='stock-card';
      let rankClass=''; if(stock.rank===1)rankClass='top1'; else if(stock.rank===2)rankClass='top2'; else if(stock.rank===3)rankClass='top3';
      const lines = (stock.summary||'').split('\n');
      const goodNews = lines.find(l=>l.includes('ğŸŸ¢'))||'';
      const badNews  = lines.find(l=>l.includes('ğŸ”´'))||'';
      const bullLink = stock.bullish_url || '';
      const bearLink = stock.bearish_url || '';

      card.innerHTML = `
        <div class="stock-header">
          <div class="stock-info">
            <div class="rank-badge ${rankClass}">${stock.rank}</div>
            <div class="stock-name">
              <h3>${stock.name}</h3>
              <div class="stock-price">${(stock.price||'').toString().replace('ì›','')}ì›</div>
            </div>
          </div>
          <div class="rate-badge">${stock.rate}</div>
        </div>
        ${(goodNews||badNews)?`
          <div class="stock-news">
            ${goodNews?`
              <div class="news-section">
                <div class="news-title news-good">${goodNews.substring(0,6)}</div>
                <div class="news-content">
                  ${goodNews.substring(7)}
                  ${bullLink?`&nbsp;<a href="${bullLink}" target="_blank" rel="noopener noreferrer">ê¸°ì‚¬ ë³´ê¸° â†—</a>`:''}
                </div>
              </div>`:''}
            ${badNews?`
              <div class="news-section">
                <div class="news-title news-bad">${badNews.substring(0,6)}</div>
                <div class="news-content">
                  ${badNews.substring(7)}
                  ${bearLink?`&nbsp;<a href="${bearLink}" target="_blank" rel="noopener noreferrer">ê¸°ì‚¬ ë³´ê¸° â†—</a>`:''}
                </div>
              </div>`:''}
          </div>`:''
        }
      `;
      card.addEventListener('click', ()=> showToast(`ğŸ“ˆ ${stock.name} ìƒì„¸ì •ë³´ (ì¤€ë¹„ì¤‘)`));
      return card;
    }

    function updateStats(stocks){
      const rates=stocks.map(s=>parseFloat((s.rate||'').replace('%','').replace('+',''))||0);
      const avg= rates.length? (rates.reduce((a,b)=>a+b,0)/rates.length).toFixed(2):0;
      document.getElementById('avgRate').textContent = `+${avg}%`;
      document.getElementById('goodNewsCount').textContent = stocks.filter(s=>s.summary&&s.summary.includes('ğŸŸ¢')).length;
      document.getElementById('totalVolume').textContent = `${50+Math.floor(Math.random()*50)}K`;
    }

    function updateTime(){
      const now=new Date();
      document.getElementById('updateTime').textContent =
        now.toLocaleDateString('ko-KR',{month:'short',day:'numeric'})+' '+
        now.toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
    }

    function renderEmptyState(){
      document.getElementById('stocksList').innerHTML =
        `<div class="empty-state"><div class="empty-icon">ğŸ“Š</div><div class="empty-title">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div><div class="empty-desc">ì ì‹œ í›„ ìë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤</div></div>`;
    }
    function renderErrorState(m){
      document.getElementById('stocksList').innerHTML = `<div class="error-message">âš ï¸ ì˜¤ë¥˜: ${m}<br><small>Flask ì„œë²„ í™•ì¸</small></div>`;
    }
    function showToast(msg,d=2200){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),d)}
    function manualRefresh(){ if(!isLoading) fetchStockData(); }

    function startAutoRefresh(){ stopAutoRefresh(); autoRefreshInterval=setInterval(fetchStockData, CONFIG.REFRESH_INTERVAL); }
    function stopAutoRefresh(){ if(autoRefreshInterval){ clearInterval(autoRefreshInterval); autoRefreshInterval=null; } }

    function startConnectionCheck(){
      connectionCheckInterval = setInterval(()=>{ if(CONFIG.MODE==='live') checkConnection(); }, 5000);
    }

    document.addEventListener('visibilitychange', ()=> document.hidden?stopAutoRefresh():(startAutoRefresh(),fetchStockData()));
    document.addEventListener('DOMContentLoaded', ()=>{
      CONFIG.MODE='test';
      setInterval(updateTime,1000);
      startConnectionCheck();
      setTimeout(fetchStockData,400);
      startAutoRefresh();
      document.addEventListener('keydown', e=>{
        if(e.key==='r'||e.key==='R') manualRefresh();
        else if(e.key==='t'||e.key==='T') switchMode('test');
        else if(e.key==='l'||e.key==='L') switchMode('live');
      });
    });

    window.addEventListener('online', ()=>{showToast('âœ… ë„¤íŠ¸ì›Œí¬ ì—°ê²°ë¨'); fetchStockData();});
    window.addEventListener('offline', ()=> showToast('âŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ëŠê¹€'));
  </script>
</body>
</html>
